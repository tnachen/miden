<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Input / Output Operations - Miden VM</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">Miden</a></li><li class="chapter-item expanded "><a href="../../intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../user_docs.html"><strong aria-hidden="true">2.</strong> User Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user_docs/overview/vm_overview.html"><strong aria-hidden="true">2.1.</strong> Miden VM Overview</a></li><li class="chapter-item expanded "><a href="../../user_docs/assembly/miden_assembly.html"><strong aria-hidden="true">2.2.</strong> Miden Assembly</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user_docs/assembly/code_organization.html"><strong aria-hidden="true">2.2.1.</strong> Code Organization</a></li><li class="chapter-item expanded "><a href="../../user_docs/assembly/inputs_and_outputs.html"><strong aria-hidden="true">2.2.2.</strong> Inputs And Outputs</a></li><li class="chapter-item expanded "><a href="../../user_docs/assembly/flow_control.html"><strong aria-hidden="true">2.2.3.</strong> Flow Control</a></li><li class="chapter-item expanded "><a href="../../user_docs/assembly/field_operations.html"><strong aria-hidden="true">2.2.4.</strong> Field Operations</a></li><li class="chapter-item expanded "><a href="../../user_docs/assembly/u32_operations.html"><strong aria-hidden="true">2.2.5.</strong> u32 Operations</a></li><li class="chapter-item expanded "><a href="../../user_docs/assembly/io_operations.html" class="active"><strong aria-hidden="true">2.2.6.</strong> Input / Output Operations</a></li><li class="chapter-item expanded "><a href="../../user_docs/assembly/cryptographic_operations.html"><strong aria-hidden="true">2.2.7.</strong> Cryptographic Operations</a></li><li class="chapter-item expanded "><a href="../../user_docs/assembly/debugging.html"><strong aria-hidden="true">2.2.8.</strong> Debugging</a></li></ol></li><li class="chapter-item expanded "><a href="../../miden_stdlib.html"><strong aria-hidden="true">2.3.</strong> Miden Standard Library</a></li></ol></li><li class="chapter-item expanded "><a href="../../design.html"><strong aria-hidden="true">3.</strong> Design</a></li><li class="chapter-item expanded "><a href="../../background.html"><strong aria-hidden="true">4.</strong> Background Material</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Miden VM</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="input--output-operations"><a class="header" href="#input--output-operations">Input / output operations</a></h2>
<p>Miden assembly provides a set of instructions for moving data between the stack and several other sources. These sources include:</p>
<ul>
<li><strong>Program code</strong>: values to be moved onto the stack can be hard-coded in a program's source code.</li>
<li><strong>Environment</strong>: values can be moved onto the stack from environment variables. Currently, the only available environment variable is <em>stack_depth</em> which holds the current depth of the stack. In the future, other environment variables may be added.</li>
<li><strong>Advice tape</strong>: values can be moved onto the stack from a non-deterministic advice tape contained within the advice provider. Values are always read from the head of the advice tape, and once a value is read, it is removed from the tape. There is no limit on the number of values in the advice tape.</li>
<li><strong>Memory</strong>: values can be moved between the stack and random-access memory. The memory is word-addressable, meaning, four elements are located at each address, and we can read and write elements to/from memory in batches of four. Memory can be accessed via absolute memory references (i.e., via memory addresses) as well as via local procedure references (i.e., local index). The latter approach ensures that a procedure does not access locals of another procedure.</li>
</ul>
<p>In the future several other sources such as <em>storage</em> and <em>logs</em> may be added.</p>
<h3 id="constant-inputs"><a class="header" href="#constant-inputs">Constant inputs</a></h3>
<table><thead><tr><th>Instruction</th><th>Stack_input</th><th>Stack_output</th><th>Notes</th></tr></thead><tbody>
<tr><td>push.<em>a</em> <br> push.<em>a</em>.<em>b</em> <br> push.<em>a</em>.<em>b</em>.<em>c</em>...</td><td>[...]</td><td>[a, ...] <br> [b, a, ...] <br> [c, b, a, ...]</td><td>Pushes values $a$, $b$, $c$ etc. onto the stack. Up to $16$ values can be specified. All values must be valid field elements in decimal (e.g., $123$) or hexadecimal (e.g., $0x7b$) representation.</td></tr>
</tbody></table>
<p>When specifying values in hexadecimal format, it is possible to omit the periods between individual values as long as total number of specified bytes is a multiple of $8$. That is, the following are semantically equivalent:</p>
<pre><code>push.0x1234.0xabcd
push.0x0000000000001234000000000000abcd
</code></pre>
<p>In both case the values must still encode valid field elements.</p>
<h3 id="environment-inputs"><a class="header" href="#environment-inputs">Environment inputs</a></h3>
<table><thead><tr><th>Instruction</th><th>Stack_input</th><th>Stack_output</th><th>Notes</th></tr></thead><tbody>
<tr><td>push.env.sdepth</td><td>[...]</td><td>[d, ...]</td><td>$d \leftarrow stack.depth()$ <br> Pushes the current depth of the stack onto the stack.</td></tr>
<tr><td>push.env.locaddr.<em>i</em></td><td>[...]</td><td>[a, ...]</td><td>$a \leftarrow address_of(i)$ <br> Pushes the absolute memory address of local memory at index $i$ onto the stack.</td></tr>
</tbody></table>
<h3 id="non-deterministic-inputs"><a class="header" href="#non-deterministic-inputs">Non-deterministic inputs</a></h3>
<table><thead><tr><th>Instruction</th><th>Stack_input_</th><th>Stack_output</th><th>Notes</th></tr></thead><tbody>
<tr><td>push.adv.<em>n</em></td><td>[ ... ]</td><td>[a, ... ]</td><td>$a \leftarrow tape.next()$ <br> Removes the next $n$ values from advice tape and pushes them onto the stack. Valid for $n \in {1, ..., 16}$. <br> Fails if the advice tape has fewer than $n$ values.</td></tr>
<tr><td>loadw.adv</td><td>[0, 0, 0, 0, ... ]</td><td>[A, ... ]</td><td>$A \leftarrow tape.next_word()$ <br> Removes the next word (4 elements) from the advice tape and overwrites the top four stack elements with it. <br> Fails if the advice tape has fewer than $4$ values.</td></tr>
</tbody></table>
<h3 id="random-access-memory"><a class="header" href="#random-access-memory">Random access memory</a></h3>
<p>As mentioned above, there are two ways to access memory in Miden VM. The first way is via memory addresses using the instructions listed below. The addresses are absolute - i.e., they don't depend on the procedure context. Memory addresses can be in the range $[0, 2^{32})$.</p>
<p>Memory is guaranteed to be initialized to zeros. Thus, when reading from memory address which hasn't been written to previously, zero elements will be returned.</p>
<table><thead><tr><th>Instruction</th><th>Stack_input___</th><th>Stack_output</th><th>Notes</th></tr></thead><tbody>
<tr><td>push.mem <br> push.mem.<em>a</em></td><td>[a, ... ]</td><td>[v, ... ]</td><td>$a \leftarrow mem[a][0]$ <br> Reads a word (4 elements) from memory at address <em>a</em>, and pushes the first element of the word onto the stack. If $a$ is provided via the stack, it is removed from the stack first. <br> Fails if $a \ge 2^{32}$</td></tr>
<tr><td>pushw.mem <br> pushw.mem.<em>a</em></td><td>[a, ... ]</td><td>[A, ... ]</td><td>$A \leftarrow mem[a]$ <br> Reads a word from memory at address $a$ and pushes it onto the stack. If $a$ is provided via the stack, it is removed from the stack first. <br> Fails if $a \ge 2^{32}$</td></tr>
<tr><td>loadw.mem <br> loadw.mem.<em>a</em></td><td>[a, 0, 0, 0, 0, ...]</td><td>[A, ... ]</td><td>$A \leftarrow mem[a]$ <br> Reads a word from memory at address $a$ and overwrites top four stack elements with it. If $a$ is provided via the stack, it is removed from the stack first. <br> Fails if $a \ge 2^{32}$</td></tr>
<tr><td>pop.mem <br> pop.mem.<em>a</em></td><td>[a, v, ...]</td><td>[ ... ]</td><td>$[v, 0, 0, 0] \rightarrow mem[a]$ <br> Pops an element off the stack and stores it as the first element of the word in memory at address $a$. All other elements of the word are set to $0$. If $a$ is provided via the stack, it is removed from the stack first. <br> Fails if $a \ge 2^{32}$</td></tr>
<tr><td>popw.mem <br> popw.mem.<em>a</em></td><td>[a, A, ...]</td><td>[ ... ]</td><td>$A \rightarrow mem[a]$ <br> Pops the top four elements off the stack and stores them in memory at address $a$. If $a$ is provided via the stack, it is removed from the stack first. <br> Fails if $a \ge 2^{32}$</td></tr>
<tr><td>storew.mem <br> storew.mem.<em>a</em></td><td>[a, A, ...]</td><td>[A, ... ]</td><td>$A \rightarrow mem[a]$ <br> Stores the top four elements of the stack in memory at address $a$. If $a$ is provided via the stack, it is removed from the stack first. <br> Fails if $a \ge 2^{32}$</td></tr>
</tbody></table>
<p>The second way to access memory is via procedure locals using the instructions listed below. These instructions are available only in procedure context. The number of locals available to a given procedure must be specified at <a href="#Procedures">procedure declaration</a> time, and trying to access more locals than was declared will result in a compile-time error. The number of locals per procedure is not limited, but the total number of locals available to all procedures at runtime must be smaller than $2^{32}$.</p>
<table><thead><tr><th>Instruction</th><th>Stack_input_</th><th>Stack_output</th><th>Notes</th></tr></thead><tbody>
<tr><td>push.local.<em>i</em></td><td>[ ... ]</td><td>[v, ... ]</td><td>$v \leftarrow local[i][0]$ <br> Reads a word (4 elements) from local memory at index <em>i</em>, and pushes the first element of the word onto the stack.</td></tr>
<tr><td>pushw.local.<em>i</em></td><td>[...]</td><td>[A, ... ]</td><td>$A \leftarrow local[i]$ <br> Reads a word from local memory at index $i$ and pushes it onto the stack.</td></tr>
<tr><td>loadw.local.<em>i</em></td><td>[0, 0, 0, 0, ...]</td><td>[A, ... ]</td><td>$A \leftarrow local[i]$ <br> Reads a word from local memory at index $i$ and overwrites top four stack elements with it.</td></tr>
<tr><td>pop.local.<em>i</em></td><td>[v, ...]</td><td>[ ... ]</td><td>$[v, 0, 0, 0] \rightarrow local[i]$ <br> Pops an element off the stack and stores it as the first element of the word in local memory at index $i$. All other elements of the word are set to $0$.</td></tr>
<tr><td>popw.local.<em>i</em></td><td>[A, ...]</td><td>[ ... ]</td><td>$A \rightarrow local[i]$ <br> Pops the top four elements off the stack and stores them in local memory at index $i$.</td></tr>
<tr><td>storew.local.<em>i</em></td><td>[A, ...]</td><td>[A, ... ]</td><td>$A \rightarrow local[i]$ <br> Stores the top four elements of the stack in local memory at index $i$.</td></tr>
</tbody></table>
<p>Unlike regular memory, procedure locals are not guaranteed to be initialized to zeros. Thus, when working with locals, one must assume that before a local memory address has been written to, it contains &quot;garbage&quot;.</p>
<p>Internally in the VM, procedure locals are stored at memory offset stating at $2^{30}$. Thus, every procedure local has an absolute address in regular memory. The <code>push.env.locaddr</code> is provided specifically to map an index of a procedure's local to an absolute address so that it can be passed to downstream procedures, when needed.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../user_docs/assembly/u32_operations.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../user_docs/assembly/cryptographic_operations.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../user_docs/assembly/u32_operations.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../user_docs/assembly/cryptographic_operations.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
